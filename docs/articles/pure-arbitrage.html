<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of Pure Arbitrage â€¢ rbattery</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example of Pure Arbitrage">
<meta property="og:description" content="rbattery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbattery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NickPTaylor/rbattery/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of Pure Arbitrage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NickPTaylor/rbattery/blob/master/vignettes/pure-arbitrage.Rmd"><code>vignettes/pure-arbitrage.Rmd</code></a></small>
      <div class="hidden name"><code>pure-arbitrage.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>rbattery</code> package provides tools for the analysis of business strategies with Battery Energy Storage Solutions (BESS). <em>Arbitrage</em> means that when the spot price of electricity is low, the battery will be charged and when it is high, it will be discharged. The battery may also be idle if it is not profitable to operate the battery.</p>
<p>Electricity is traded by blocks of time, known as settlement periods, having a duration of 30 minutes. For a perfect battery, an income can be made for any pair of settlement periods where there is a spot price differential. However, real batteries are subject to efficiency losses when charging or discharging. Therefore, an arbitrage charge/discharge operation is not always profitable, even when there is a price differential.</p>
<p>Arbitrage optimisation is subject to constraints due to the physical capacity of the battery and external factors, such as requirements for participating in other markets, in conjunction with arbitrage. For a detailed description of the optimisation method, refer to the <a href="optimisation-algorithm.html">Optimisation Algorithm</a> vignette. Often, arbitrage will supplement income from other electricity markets. However, the aim of the analysis in this document is to demonstrate a simple example of optimising battery operation for arbitrage only.</p>
</div>
<div id="method" class="section level1">
<h1 class="hasAnchor">
<a href="#method" class="anchor"></a>Method</h1>
<p>The <code>rbattery</code> package provides historical example data for the <a href="https://www.apxgroup.com/trading-clearing/spot-market/">EPEX SPOT Intra-day Market</a> from April 2016 - April 2017.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">spot_price_2016</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   timestamp            N2EX  EPEX   SSP</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2016-04-01 00:00:00  28.4  27.4  24.9</span>
<span class="co">#&gt; 2 2016-04-01 00:30:00  28.4  28.0  27.0</span>
<span class="co">#&gt; 3 2016-04-01 01:00:00  28.0  29.9  38.8</span>
<span class="co">#&gt; 4 2016-04-01 01:30:00  28.0  33.1 140  </span>
<span class="co">#&gt; 5 2016-04-01 02:00:00  27.0  31.8  40.3</span>
<span class="co">#&gt; 6 2016-04-01 02:30:00  27.0  28.6  24.6</span></pre></body></html></div>
<p>Consider optimising arbitrage for these spot prices for a 100% efficient battery and a 90% efficient battery. The <code><a href="../reference/optimise_arbitrage.html">optimise_arbitrage()</a></code> function is used, as follows:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">opt_100</span> <span class="kw">&lt;-</span> <span class="no">spot_price_2016</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">timestamp</span>, <span class="no">EPEX</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/optimise_arbitrage.html">optimise_arbitrage</a></span>(<span class="kw">price_from</span> <span class="kw">=</span> <span class="st">"EPEX"</span>, <span class="kw">capacity</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">c_rate</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">3</span>,
                     <span class="kw">efficiency</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="no">opt_90</span> <span class="kw">&lt;-</span> <span class="no">spot_price_2016</span> <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">timestamp</span>, <span class="no">EPEX</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/optimise_arbitrage.html">optimise_arbitrage</a></span>(<span class="kw">price_from</span> <span class="kw">=</span> <span class="st">"EPEX"</span>, <span class="kw">capacity</span> <span class="kw">=</span> <span class="fl">6</span>, <span class="kw">c_rate</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="fl">3</span>,
                     <span class="kw">efficiency</span> <span class="kw">=</span> <span class="fl">.9</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">opt_100</span>)
<span class="co">#&gt;             timestamp  EPEX charge_state discharge charge arb_income deg_cost</span>
<span class="co">#&gt; 1 2016-04-01 00:00:00 27.42            0         0      1     -27.42        0</span>
<span class="co">#&gt; 2 2016-04-01 00:30:00 28.04            1         0      1     -28.04        0</span>
<span class="co">#&gt; 3 2016-04-01 01:00:00 29.93            2         0      0       0.00        0</span>
<span class="co">#&gt; 4 2016-04-01 01:30:00 33.10            2         1      0      33.10        0</span>
<span class="co">#&gt; 5 2016-04-01 02:00:00 31.84            1         1      0      31.84        0</span>
<span class="co">#&gt; 6 2016-04-01 02:30:00 28.57            0         0      0       0.00        0</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">opt_90</span>)
<span class="co">#&gt;             timestamp  EPEX charge_state discharge charge arb_income deg_cost</span>
<span class="co">#&gt; 1 2016-04-01 00:00:00 27.42            0         0      0          0        0</span>
<span class="co">#&gt; 2 2016-04-01 00:30:00 28.04            0         0      0          0        0</span>
<span class="co">#&gt; 3 2016-04-01 01:00:00 29.93            0         0      0          0        0</span>
<span class="co">#&gt; 4 2016-04-01 01:30:00 33.10            0         0      0          0        0</span>
<span class="co">#&gt; 5 2016-04-01 02:00:00 31.84            0         0      0          0        0</span>
<span class="co">#&gt; 6 2016-04-01 02:30:00 28.57            0         0      0          0        0</span></pre></body></html></div>
<p>Notice that <code>optimise_arbitrage</code> takes a <code>data.frame</code> as the first argument and returns a <code>data.frame</code>. The returned <code>data.frame</code> includes the input combined with the battery operating results for the optimisation. The function was designed in this way in order to facilitate its use within a <a href="https://www.tidyverse.org/">tidyverse</a> style workflow i.e.Â the use of the <a href="https://magrittr.tidyverse.org/">pipe operator</a>, <code>%&gt;%</code>.</p>
</div>
<div id="results" class="section level1">
<h1 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h1>
<p>The income from the optimisations is available by summing the <code>arb_income</code> column from the results. For example:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">result_fmt</span> <span class="kw">&lt;-</span> <span class="st">"Income from {efficiency}% battery: Â£{income}k"</span>
<span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="no">result_fmt</span>, <span class="kw">efficiency</span> <span class="kw">=</span> <span class="fl">100</span>,
           <span class="kw">income</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">opt_100</span>$<span class="no">arb_income</span>)/<span class="fl">1000</span>))
<span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="no">result_fmt</span>, <span class="kw">efficiency</span> <span class="kw">=</span> <span class="fl">90</span>,
           <span class="kw">income</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">opt_90</span>$<span class="no">arb_income</span>)/<span class="fl">1000</span>))
<span class="co">#&gt; Income from 100% battery: Â£131k</span>
<span class="co">#&gt; Income from 90% battery: Â£86k</span></pre></body></html></div>
<p>The code below performs some manipulation on the results and then plots the optimal battery operation for each case on 01/01/2017.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Libraries.</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lubridate</span>)

<span class="co"># Plot bewteen these times.</span>
<span class="no">start_time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">'2017-01-01 00:00:00'</span>)
<span class="no">end_time</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span>(<span class="st">'2017-01-02 00:00:00'</span>)

<span class="no">my_plot</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">opt</span>, <span class="no">efficiency</span>) {

  <span class="co"># Combine data, reshape and filter for plot.</span>
  <span class="no">df_plt</span> <span class="kw">&lt;-</span> <span class="no">opt</span> <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">idle</span> <span class="kw">=</span> <span class="fl">1</span> - <span class="no">charge</span> - <span class="no">discharge</span>) <span class="kw">%&gt;%</span>
      <span class="fu">pivot_longer</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">discharge</span>, <span class="no">charge</span>, <span class="no">idle</span>), <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">'op_mode'</span>,
                   <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">'t_prop'</span>) <span class="kw">%&gt;%</span>
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">between</span>(<span class="no">timestamp</span>, <span class="no">start_time</span>, <span class="no">end_time</span>))

  <span class="co"># Calculate operation mode overlay tiles on plot.</span>
  <span class="no">range_epex</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">df_plt</span>$<span class="no">EPEX</span>) * <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.95</span>, <span class="fl">1.05</span>)
  <span class="no">df_plt</span> <span class="kw">&lt;-</span> <span class="no">df_plt</span> <span class="kw">%&gt;%</span>
      <span class="fu">group_by</span>(<span class="no">timestamp</span>) <span class="kw">%&gt;%</span>
      <span class="fu">mutate</span>(<span class="kw">height</span> <span class="kw">=</span> <span class="no">t_prop</span> * (<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="no">range_epex</span>)),
             <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">range_epex</span>) + (<span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">height</span>)) - <span class="no">height</span>/<span class="fl">2</span>) <span class="kw">%&gt;%</span>
      <span class="fu">ungroup</span>()

  <span class="co"># Plot operation mode.</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df_plt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timestamp</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="no">height</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">op_mode</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.4</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timestamp</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">EPEX</span>), <span class="kw">inherit.aes</span> <span class="kw">=</span> <span class="fl">FALSE</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timestamp</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">EPEX</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.5</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_datetime</a></span>(
          <span class="kw">date_labels</span> <span class="kw">=</span> <span class="st">'%H:%M'</span>,
          <span class="kw">breaks</span> <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw">from</span> <span class="kw">=</span> <span class="no">start_time</span>, <span class="kw">to</span> <span class="kw">=</span> <span class="no">end_time</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">'3 hours'</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(
        <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">discharge</span> <span class="kw">=</span> <span class="st">'green'</span>, <span class="kw">idle</span> <span class="kw">=</span> <span class="st">'grey20'</span>, <span class="kw">charge</span> <span class="kw">=</span> <span class="st">'red'</span>),
        <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">discharge</span> <span class="kw">=</span> <span class="st">'Discharge'</span>, <span class="kw">idle</span> <span class="kw">=</span> <span class="st">'Idle'</span>,
                   <span class="kw">charge</span> <span class="kw">=</span> <span class="st">'Charge'</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>,
           <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Spot Price (Â£/MWh)"</span>,
           <span class="kw">title</span> <span class="kw">=</span> <span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="st">"Optimised arbitrage for a {efficiency}% \\
                              efficient battery"</span>),
           <span class="kw">subtitle</span> <span class="kw">=</span> <span class="kw pkg">glue</span><span class="kw ns">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span>(<span class="st">"Date: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span>(<span class="no">start_time</span>, <span class="st">'%D'</span>)),
           <span class="kw">fill</span> <span class="kw">=</span> <span class="st">''</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_linedraw</a></span>() +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'bottom'</span>,
          <span class="kw">legend.justification</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">0</span>),
          <span class="kw">legend.direction</span> <span class="kw">=</span> <span class="st">'horizontal'</span>)
}

<span class="co"># Print plots</span>
<span class="fu">my_plot</span>(<span class="no">opt_100</span>, <span class="fl">100</span>)
<span class="fu">my_plot</span>(<span class="no">opt_90</span>, <span class="fl">90</span>)</pre></body></html></div>
<p><img src="pure-arbitrage_files/figure-html/plot-1.png" width="70%" style="display: block; margin: auto;"><img src="pure-arbitrage_files/figure-html/plot-2.png" width="70%" style="display: block; margin: auto;"></p>
<p>As expected, it is observed that when the efficiency is less than 1, that the profitability of the arbitrage market decreases.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Taylor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
