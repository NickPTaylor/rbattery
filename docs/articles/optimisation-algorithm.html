<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimisation Algorithm • rbattery</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Optimisation Algorithm">
<meta property="og:description" content="rbattery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbattery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NickPTaylor/rbattery/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Optimisation Algorithm</h1>
                        <h4 class="author">Nick Taylor</h4>
            
            <h4 class="date">2020-05-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NickPTaylor/rbattery/blob/master/vignettes/optimisation-algorithm.Rmd"><code>vignettes/optimisation-algorithm.Rmd</code></a></small>
      <div class="hidden name"><code>optimisation-algorithm.Rmd</code></div>

    </div>

    
    
<style type="text/css">
table {
    min-width: 80%;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The objective of the model is to:</p>
<blockquote>
<p>Maximise income for a battery storage solution for the <em>arbitrage</em> market. The algorithm can be applied to pure arbitrage and optionally, constraints can be included to represent participation in balancing service markets.</p>
</blockquote>
<p>The model is formulated as a <em>linear programme</em>. The linear programme is implemented using the <a href="https://cran.r-project.org/web/packages/ompr/index.html"><code>ompr</code></a> package.</p>
</div>
<div id="assumptions" class="section level2">
<h2 class="hasAnchor">
<a href="#assumptions" class="anchor"></a>Assumptions</h2>
<p>The following assumptions and simplifications apply:</p>
<ul>
<li>Perfect foresight of electricity spot prices. The intent is to provide tools for forecasting spot prices in the future.</li>
<li>The battery has zero charge at the beginning of the first settlement period.</li>
<li>Round-trip efficiency is considered but other efficiencies are not. The round trip efficiency reflects the losses due to transmission. It is assumed that the losses incurred for charge/discharge are equally distributed and therefore, the efficiency for each will be the square root of the round trip efficiency.</li>
<li>Depth of discharge is 100% i.e. the full battery capacity is available at all times.</li>
</ul>
</div>
<div id="model" class="section level2">
<h2 class="hasAnchor">
<a href="#model" class="anchor"></a>Model</h2>
<div id="nomenclature" class="section level3">
<h3 class="hasAnchor">
<a href="#nomenclature" class="anchor"></a>Nomenclature</h3>
<p>The model <em>parameters</em> are as follows:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="left">Unit</th>
<th align="left">Symbol</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Capacity</td>
<td align="left">MWh</td>
<td align="left"><span class="math inline">\(E\)</span></td>
</tr>
<tr class="even">
<td align="left">Charge rate</td>
<td align="left">1/h</td>
<td align="left"><span class="math inline">\(\rho\)</span></td>
</tr>
<tr class="odd">
<td align="left">Degradation cost</td>
<td align="left">£/cycle</td>
<td align="left"><span class="math inline">\(\overline{D}\)</span></td>
</tr>
<tr class="even">
<td align="left">Efficiency</td>
<td align="left">%</td>
<td align="left"><span class="math inline">\(\eta\)</span></td>
</tr>
<tr class="odd">
<td align="left">NPV of Future Price</td>
<td align="left">£</td>
<td align="left"><span class="math inline">\(F_{NPV}\)</span></td>
</tr>
<tr class="even">
<td align="left">Settlement period</td>
<td align="left">h</td>
<td align="left"><span class="math inline">\(t\)</span></td>
</tr>
</tbody>
</table>
<p>Let <span class="math inline">\(i\)</span> denote the <span class="math inline">\(i\)</span>th settlement period where <span class="math inline">\(i=0\)</span> is the first period of interest and <span class="math inline">\(i=N\)</span> is the last period on interest. The <em>variables</em> for period <span class="math inline">\(i\)</span> are:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Variables</th>
<th align="left">Type</th>
<th align="left">Unit</th>
<th align="left">Symbol</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Spot price</td>
<td align="left">Input</td>
<td align="left">£/MWh</td>
<td align="left"><span class="math inline">\(P_i\)</span></td>
</tr>
<tr class="even">
<td align="left">Degradation cost</td>
<td align="left">Input</td>
<td align="left">£</td>
<td align="left"><span class="math inline">\(\hat{D}_i\)</span></td>
</tr>
<tr class="odd">
<td align="left">Charge state</td>
<td align="left">Output</td>
<td align="left">MWh</td>
<td align="left"><span class="math inline">\(\hat{E}_i\)</span></td>
</tr>
<tr class="even">
<td align="left">Proportion of period spent charging</td>
<td align="left">Output</td>
<td align="left">-</td>
<td align="left"><span class="math inline">\({C_i}^+\)</span></td>
</tr>
<tr class="odd">
<td align="left">Proportion of period spent discharging</td>
<td align="left">Output</td>
<td align="left">-</td>
<td align="left"><span class="math inline">\({C_i}^-\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="constraints" class="section level3">
<h3 class="hasAnchor">
<a href="#constraints" class="anchor"></a>Constraints</h3>
<p><strong>Operation</strong>. The variables, <span class="math inline">\({C_i}^+\)</span> and <span class="math inline">\({C_i}^-\)</span>, denote the the proportion of settlement period <span class="math inline">\(i\)</span> that the battery is charging or discharging respectively. Both variables must be between 0 and 1, since they are proportions. The sum of the two variables must be equal to or less than 1 since this also is a proportion <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. When the sum is less than 1, this indicates that the battery is idle for part of the period; if the battery is idle for all of the period, the sum is 0. The constraints are:</p>
<p><span class="math display">\[
    0 \leq {C_i}^+ \\
    0 \leq {C_i}^- \\
    {C_i}^+ + {C_i}^- \leq 1
\]</span></p>
<p><strong>Battery Charge State</strong>. Let <span class="math inline">\(\hat{E}_i\)</span> denote the charge state at the <em>beginning</em> of settlement period <span class="math inline">\(i\)</span>. The charge state must always be between between fully discharged and fully charged. Therefore:</p>
<p><span class="math display">\[
0 \leq \hat{E_i} \leq 0 \\
\]</span></p>
<p>In order ensure the continuity of charge between the end of each settlement period and the beginning of the next, the following constraint applies:</p>
<p><span class="math display">\[
\hat{E}_{i} = \hat{E}_{i-1} + \rho E t \left[ {C_{i-1}}^+ - {C_{i-1}}^- \right]
\]</span></p>
<p>The term, <span class="math inline">\(\rho E t\)</span>, is the absolute amount of charge/discharge energy during a settlement period for the case when the battery charges/discharges during the entire cycle. The initial charge is fixed at 0, therefore:</p>
<p><span class="math display">\[
\hat{E}_0 = 0
\]</span></p>
<p>Also, noting that <span class="math inline">\(\hat{E}_{i}\)</span> refers to the charge at the <em>beginning</em> of a settlement period, it is required to constrain the charge at the <em>end</em> of the <em>last</em> settlement period i.e.:</p>
<p><span class="math display">\[
  0 \leq \hat{E}_N + \rho E t \left[ {C_N}^+ - {C_N}^- \right] \leq E
\]</span></p>
<p><strong>Balancing Markets</strong>. The model optionally facilitates participation in other markets. This imposes further constraints on the optimisation problem.</p>
<ul>
<li><p>Typically, arbitrage cannot operate when participating in another market. Therefore, constraints may be added to stop arbitrage activity i.e. constrain the battery to be ‘idle’ with respect to arbitrage.</p></li>
<li>Participation in a market will require delivery of a specified amount energy at a specific time and over a specific period. Constraints may be included in the arbitrage optimisation to ensure that sufficient charge/discharge capacity is available to facilitate this.</li>
<li><p>Additional charge/discharge from participation in any other market may be input into the arbitrage optimisation to ensure account for charge/discharge activity which is <em>not</em> due to arbitrage.</p></li>
</ul>
</div>
<div id="degradation" class="section level3">
<h3 class="hasAnchor">
<a href="#degradation" class="anchor"></a>Degradation</h3>
<p>Degradation can be calculated using similar principles to that of <a href="https://corporatefinanceinstitute.com/resources/knowledge/finance/levelized-cost-of-energy-lcoe/">Levelised Cost</a>, which can be described as:</p>
<blockquote>
<p>the average total cost of building and operating the asset, per unit of total electricity generated over an assumed lifetime.</p>
</blockquote>
<p>The reader is referred to the link for full details. Degradation should be accounted for when determining whether electricity generation is profitable. Using the levelised cost approach, firstly, a <em>future cost</em> should be estimated. For example, this could be the cost of restoring the battery to its original specification after some period, although the future cost can be estimated using various approaches. A degradation cost per unit electricity generated is then be calculated as follows:</p>
<p><span class="math display">\[
D = \frac{F_{NPV}}{\eta^2 \rho E t} \cdot
    \frac{1}{\sum_{i=0}^N \left({C_i}^+ + {C_i}^- \right)}
\]</span></p>
<p>Note that the <em>electricity generated</em> is based the energy discharged <em>at meter</em> after a charge/discharge cycle. Modelling the degradation in this way is not suitable for a linear programming approach. The future net present value <span class="math inline">\(F_{NPV}\)</span> depends on the amount of degradation which in turn will depend on the number of cycles. This is not linear.</p>
<p>The problem is simplified by assuming an upfront fixed degradation cost per cycle, <span class="math inline">\(\overline{D}\)</span>. Then, for each settlement period, the total <em>absolute</em> charge/discharge can be used to deduce the fraction of a full cycle operation occurring during the settlement period. The product of the cycle fraction and the degradation cost per cycle gives a degradation cost of the settlement period i.e.</p>
<p><span class="math display">\[
\hat{D}_i = \overline{D} \left(
    \frac{\left[ \rho E t \right] \left[ {C_i}^+ + {C_i}^- \right]}{2E}
\right)
\]</span> Note that in the bracketed term, the numerator is the sum of absolute charge/discharge energy and the denominator is the total charge/discharge energy for a full cycle i.e. twice the battery capacity. This simpler approach to degradation assignment facilitates the application of a linear program.</p>
</div>
<div id="objective" class="section level3">
<h3 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h3>
<p>The objective is to maximise profit from arbitrage. The income from charging during one settlement period is:</p>
<p><span class="math display">\[
     - \left[ \rho E t \right] \frac{{C_i}^+} {\eta} P_i
\]</span></p>
<p>Clearly, the income is always negative when charging. Note that due to the efficiency penalty, more energy is metered i.e. paid for than the observed change in battery capacity. The value of <span class="math inline">\(P_i\)</span> are prices and cost <em>at meter</em>. Hence, an adjustment is made using the efficiency, <span class="math inline">\(\eta\)</span>, to account for this.</p>
<p>The income from discharging is:</p>
<p><span class="math display">\[
     \left[ \rho E t \right] {C_i}^- \eta P_i
\]</span></p>
<p>For discharging, the efficiency penalty means that <em>less</em> energy is metered i.e. payment received for, than is actually discharged. Combining the income from discharging, the cost for charging and the loss due to degradation, the objective function after simplification is:</p>
<p><span class="math display">\[
\max \left[  
    \sum_{i=0}^N
        P_i \left( \eta^2 {C_i}^- - {C_i}^+ \right) -
        \eta \overline{D} 
        \left(
            \frac{\left[ {C_i}^+ + {C_i}^- \right]}{2 E}
        \right)
\right]
\]</span></p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>In practice, the battery should not charge and discharge in the same settlement period. The spot price is fixed in a settlement period so there is not possibility to profit from this action and in fact, a loss will be made due to battery degradation from operation. Hence, this constraint effectively sets each of <span class="math inline">\({C_i}^+\)</span> and <span class="math inline">\({C_i}^-\)</span> to be less than 1 as individual variables; however, setting the constraint as a sum of the variables captures the intent of the constraint more explicitly.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Taylor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
